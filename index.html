<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Gest√£o Buffet ‚Äì Al√©m do Bolo</title>

<style>
:root{
  --primaria:#0f172a;
  --destaque:#10b981;
  --fundo:#f8fafc;
  --borda:#e2e8f0;
}
body{margin:0;font-family:Segoe UI,sans-serif;display:flex;background:var(--fundo)}
nav{width:300px;background:var(--primaria);color:#fff;height:100vh;position:fixed;padding:18px;overflow:auto}
nav h2{color:var(--destaque);margin-bottom:10px}
.btn-menu{width:100%;margin-bottom:6px;padding:10px;background:#1e293b;border:0;color:white;border-radius:6px;text-align:left;cursor:pointer}
.btn-menu:hover{background:rgba(16,185,129,.15)}
.label{font-size:.7rem;color:#94a3b8;margin:12px 0 6px}
main{margin-left:320px;padding:24px;width:100%}
.card{background:#fff;padding:20px;border-radius:10px;border:1px solid var(--borda);margin-bottom:16px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:10px;border-bottom:1px solid var(--borda);text-align:left}
.btn{padding:8px 12px;border-radius:6px;border:none;cursor:pointer}
.primary{background:var(--destaque);color:#fff}
.ghost{background:#fff;border:1px solid var(--borda)}
.alert{color:#dc2626;font-weight:600}
input,select{width:100%;padding:6px;margin-bottom:6px}
.small{font-size:.9rem}
.hidden{display:none}
</style>
</head>

<body>

<nav>
<h2>BUFFET PRO</h2>

<div class="label">Acesso</div>
<button class="btn-menu" onclick="login('admin')">üëë Admin</button>
<button class="btn-menu" onclick="login('staff')">üë∑ Staff</button>

<div class="label">Estoque</div>
<button class="btn-menu" onclick="renderCategoria('C√¢mara')">üì¶ C√¢mara</button>
<button class="btn-menu" onclick="renderCategoria('Freezer')">‚ùÑÔ∏è Freezer</button>
<button class="btn-menu" onclick="renderCategoria('Equipamento')">‚ö° Equipamentos</button>
<button class="btn-menu" onclick="renderCategoria('Material')">üçΩÔ∏è Materiais</button>

<div class="label">Comercial</div>
<button class="btn-menu" onclick="renderPropostas()">üìã Propostas</button>

<div class="label">Admin</div>
<button class="btn-menu admin-only" onclick="renderCadastro()">‚ûï Cadastrar Item</button>
<button class="btn-menu admin-only" onclick="renderEventos()">üìÜ Eventos</button>
<button class="btn-menu admin-only" onclick="renderRelatorio()">üìä Relat√≥rio Mensal</button>
<button class="btn-menu admin-only" onclick="exportarInventario()">‚¨áÔ∏è Exportar Invent√°rio</button>
</nav>

<main id="app"></main>

<script>
/* ====== AUTH ====== */
let role = localStorage.getItem('role') || 'staff';
function login(r){
  role = r;
  localStorage.setItem('role',r);
  document.querySelectorAll('.admin-only').forEach(b=>{
    b.style.display = role==='admin'?'block':'none';
  });
  alert('Logado como '+r);
  renderHome();
}

/* ====== DATA ====== */
let estoque = JSON.parse(localStorage.getItem('estoque')) || [
 {id:1,nome:'Carne',cat:'C√¢mara',qtd:30,min:10},
 {id:2,nome:'Polpa de fruta',cat:'Freezer',qtd:40,min:15},
 {id:3,nome:'Pratos',cat:'Material',qtd:120,min:80},
 {id:4,nome:'Fritadeira',cat:'Equipamento',qtd:2,min:1}
];
let eventos = JSON.parse(localStorage.getItem('eventos')) || [];

/* ====== HOME ====== */
function renderHome(){
 document.getElementById('app').innerHTML = `
  <div class="card">
    <h2>Gest√£o de Buffet</h2>
    <p>Controle total de estoque, eventos e propostas.</p>
    <p><b>Perfil:</b> ${role}</p>
  </div>`;
}
renderHome();
login(role);

/* ====== ESTOQUE ====== */
function renderCategoria(cat){
 let itens = estoque.filter(i=>i.cat===cat);
 let html = `
 <div class="card">
 <h3>${cat}</h3>
 <table>
 <tr><th>Item</th><th>Qtd</th><th>A√ß√£o</th></tr>`;
 itens.forEach(i=>{
  html+=`
   <tr>
    <td>${i.nome}</td>
    <td class="${i.qtd<i.min?'alert':''}">${i.qtd}</td>
    <td>
      <button class="btn ghost" onclick="ajustar(${i.id},1)">+</button>
      <button class="btn ghost" onclick="ajustar(${i.id},-1)">-</button>
    </td>
   </tr>`;
 });
 html+='</table></div>';
 document.getElementById('app').innerHTML=html;
}
function ajustar(id,v){
 let it = estoque.find(i=>i.id===id);
 if(!it) return;
 it.qtd=Math.max(0,it.qtd+v);
 localStorage.setItem('estoque',JSON.stringify(estoque));
 renderCategoria(it.cat);
}

/* ====== CADASTRO ====== */
function renderCadastro(){
 if(role!=='admin') return;
 document.getElementById('app').innerHTML=`
 <div class="card">
 <h3>Cadastrar Item</h3>
 <input id="n" placeholder="Nome">
 <select id="c">
  <option>C√¢mara</option><option>Freezer</option>
  <option>Equipamento</option><option>Material</option>
 </select>
 <input id="q" type="number" placeholder="Qtd">
 <input id="m" type="number" placeholder="M√≠nimo">
 <button class="btn primary" onclick="salvar()">Salvar</button>
 </div>`;
}
function salvar(){
 estoque.push({
  id:Date.now(),
  nome:n.value,
  cat:c.value,
  qtd:+q.value||0,
  min:+m.value||0
 });
 localStorage.setItem('estoque',JSON.stringify(estoque));
 renderHome();
}

/* ====== PROPOSTAS ====== */
function renderPropostas(){
 document.getElementById('app').innerHTML=`
 <div class="card">
 <h3>Nova Proposta</h3>
 <button class="btn primary" onclick="criarEvento()">Confirmar Evento</button>
 </div>`;
}
function criarEvento(){
 let itens = estoque.map(i=>({id:i.id,nome:i.nome,qty:1}));
 itens.forEach(it=>{
  let prod=estoque.find(p=>p.id===it.id);
  prod.qtd=Math.max(0,prod.qtd-it.qty);
 });
 eventos.push({
  id:Date.now(),
  data:new Date().toISOString(),
  itens:itens,
  status:'ativo'
 });
 localStorage.setItem('estoque',JSON.stringify(estoque));
 localStorage.setItem('eventos',JSON.stringify(eventos));
 renderEventos();
}

/* ====== EVENTOS + HISTORIAL ====== */
function renderEventos(){
 let html=`
 <div class="card">
 <h3>Eventos</h3>
 <table>
 <tr><th>Data</th><th>Status</th><th>A√ß√£o</th></tr>`;
 eventos.forEach(e=>{
  html+=`
   <tr>
    <td>${new Date(e.data).toLocaleString()}</td>
    <td>${e.status}</td>
    <td>${e.status==='ativo'
      ?`<button class="btn ghost" onclick="finalizar(${e.id})">Finalizar</button>`
      :'‚úî'}</td>
   </tr>`;
 });
 html+='</table></div>';
 document.getElementById('app').innerHTML=html;
}
function finalizar(id){
 let ev=eventos.find(e=>e.id===id);
 if(!ev) return;
 ev.itens.forEach(it=>{
  let p=estoque.find(x=>x.id===it.id);
  if(p) p.qtd+=it.qty;
 });
 ev.status='finalizado';
 localStorage.setItem('estoque',JSON.stringify(estoque));
 localStorage.setItem('eventos',JSON.stringify(eventos));
 renderEventos();
}

/* ====== RELAT√ìRIO MENSAL ====== */
function renderRelatorio(){
 let porMes={};
 eventos.forEach(e=>{
  let m=new Date(e.data).toISOString().slice(0,7);
  porMes[m]=(porMes[m]||0)+1;
 });
 let html=`<div class="card"><h3>Relat√≥rio Mensal</h3><ul>`;
 Object.keys(porMes).forEach(m=>{
  html+=`<li>${m} ‚Äî ${porMes[m]} eventos</li>`;
 });
 html+='</ul></div>';
 document.getElementById('app').innerHTML=html;
}

/* ====== EXPORT INVENT√ÅRIO ====== */
function exportarInventario(){
 let csv='Item,Categoria,Quantidade,M√≠nimo\n';
 estoque.forEach(i=>{
  csv+=`${i.nome},${i.cat},${i.qtd},${i.min}\n`;
 });
 let blob=new Blob([csv],{type:'text/csv'});
 let a=document.createElement('a');
 a.href=URL.createObjectURL(blob);
 a.download='inventario_buffet.csv';
 a.click();
}
</script>

</body>
</html>

